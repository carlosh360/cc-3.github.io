<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="../stylesheets/w3.css">
        <link rel="stylesheet" href="../stylesheets/w3-theme-black.css">
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
        <link rel="icon" href="../images/favicon.png" type="image/x-icon">
        <title>CC3 LAB 5</title>
        <style>
            header {
                background-image: url("../images/header.jpg");
                color: white;
                width:100%;
                min-height:400px;
                max-height:700px;
            }
            .w3-topnav a:first-child:hover{color: #009688;border-bottom: 3px solid transparent;}
        </style>
    </head>
    <body class="w3-light-grey">
        <nav class="w3-topnav w3-center w3-theme w3-card-4 w3-top">
              <a href="../index.html" title="HOME"><i class="fa fa-home w3-large"></i></a>
        </nav>
        <header id="header" class="w3-container w3-card-4 w3-padding-32">
            <div class="w3-center w3-padding-32">
                <div class="w3-center">
                    <h1 class="w3-jumbo">CC3 Estructura de Máquinas</h1>
                    <h1 class="w3-jumbo w3-animate-bottom">Laboratorio 5</h1>
                    <h4 class="w3-xxlarge">Llamadas a funciones y Punteros en MIPS</h4>
                </div>
            </div>
        </header>
        <div class="w3-container w3-margin-16">
            <h1 id="notas" class="w3-card-24 w3-theme w3-round-large w3-padding-left w3-card-4">Objetivos</h1>
            <div class="w3-card-24 w3-white w3-padding-8 w3-round-large">
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    <ul>
                        <li class="w3-large">Ganar más práctica en llamadas a funciones en MIPS.</li>
                        <li class="w3-large">Manipular punteros en MIPS.</li>
                    </ul>
                </p>
            </div>
            <h1 id="notas" class="w3-card-24 w3-theme w3-round-large w3-padding-left w3-card-4">Setup</h1>
            <div class="w3-card-24 w3-white w3-padding-8 w3-round-large">
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    Descarguen los archivos necesarios para este laboratorio en el siguiente <a href="#" target="_blank"><span class="w3-btn w3-red w3-round w3-medium">link</link></a>
                </p>
            </div>
            <h1 id="notas" class="w3-card-24 w3-theme w3-round-large w3-padding-left w3-card-4">Ejercicio 1</h1>
            <div class="w3-card-24 w3-white w3-padding-8 w3-round-large">
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    <strong>Este ejercicio usa el archivo listmanips.s</strong><br><br>
                    En este ejercicio, ustedes van a implementar una función map en MIPS. Su función va ser simplimente cambiar una lista in-place, es decir, sin la necesidad de crear y retornar una nueva lista con los valores modificados. Su procedimiento “map” va a tomar dos parámetros. El primer parámetro va a ser la dirección del head de una linked-list que sus valores son enteros de 32-bits. Así que el struct en C estaría definido de la siguiente manera:
<pre class="w3-code w3-light-grey notranslate">
    <span class="w3-text-red">struct</span> node {

        <span class="w3-text-teal">int</span> value;
        <span class="w3-text-red">struct</span> node *next;

    };
</pre>
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    El segundo parámetro va a ser la dirección de la función que toma como parámetro un entero y devuelve un entero. Van a utilizar jalr para llamar a esta función con la lista.
                    <br><br>
                    Su función “map” recursivamente va ir bajando en la lista visitando cada nodo, aplicando la función a cada valor de la lista y guardando el valor retornado en esa posición. En C, esto se miraría algo así:
                </p>
<pre class="w3-code w3-light-grey notranslate">
    <span class="w3-text-red">void</span> map(<span class="w3-text-red">struct</span> node *head, <span class="w3-text-teal">int</span> (*f)(<span class="w3-text-teal">int</span>)) {

      <span class="w3-text-teal">if</span>(!head) { return; }
      head->value = f(head->value);
      map(head->next,f);

    }
</pre>
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    Si nunca habían visto este tipo de declaración (*f)(int), no se preocupen. Básicamente significa que f es un puntero hacia una función, que en C es utilizada como cualquier otra función.
                    <br><br>
                    Van a necesitar usar una instrucción que tal vez no hayan visto antes, para implementar esto: jalr. jalr casi lo mismo que jr, solo que esta instrucción salta a una dirección que esta guardada en un registro y guarda la dirección de la siguiente instrucción (esto es PC + 4) en $ra. Así que si no quieren utilizar jal, pueden usar jalr para llamar a una función así:
                </p>
<pre class="w3-code w3-light-grey notranslate">
    <span class="w3-text-grey"># I want to call the function garply, but not use jal.</span>
    <span class="w3-text-red">la</span> <span class="w3-text-teal">$</span>t0 garply <span class="w3-text-grey"># so I use la to load the address of garply into a register ($t0)</span>
    <span class="w3-text-red">jalr</span> <span class="w3-text-teal">$</span>t0      <span class="w3-text-grey"># and then use jalr to jump and link to it.</span>
</pre>
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    Hay 7 lugares (6 en map y 1 en main) en el codigo que les dimos que dicen “YOUR_INSTRUCTION_HERE”. Remplacen estas instrucciones para finalizar la implementación de map, y hagan que el programa llame a map con square como la función que se pasa en los argumentos. Cuando hayan terminado de completar todo, al correr el código les debería generar la siguiente salida:
                </p>
<pre class="w3-code w3-light-grey notranslate">
    <span class="w3-text-brown">List Before: 9 8 7 6 5 4 3 2 1 0
    List After: 81 64 49 36 25 16 9 4 1 0</span>
</pre>
            </div>
            <h1 id="notas" class="w3-card-24 w3-theme w3-round-large w3-padding-left w3-card-4">Ejercicio 2</h1>
            <div class="w3-card-24 w3-white w3-padding-8 w3-round-large">
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    Añadan el prologo y el epilogo al código en nchoosek.s que calcula nCr = n!/(r!(n-r)!) que en teoria combinatoria es un método de selección de varios elementos o símbolos de un grupo más grande o un conjunto de datos, donde no importa una orden. Esta función esta en su calculadora y nCr.
                </p>
            </div>
            <h1 id="notas" class="w3-card-24 w3-theme w3-round-large w3-padding-left w3-card-4">Ejercicio 3</h1>
            <div class="w3-card-24 w3-white w3-padding-8 w3-round-large">
                <p class="w3-text w3-justify w3-large w3-margin-16">
                    Escriban 2 versiones de una función llamada first1pos (usando first1pos.s) que, dado un valor en el registro $a0, retorne en el registro $v0 la posición del bit más significativo en el registro $a0. Si $a0 tiene como valor el 0, guarden -1 en el registro $v0. Esta permitido que modifiquen $a0 en el proceso de buscar la posición. Las posiciones van de 0 (el bit menos significativo) a 31 (el bit mas significativo).
                    <br><br>
                    Una de sus soluciones repetidamente tiene que hacer shift a $a0, verificando el “bit de signo” en cada shift. La otra solución debería utilizar un mask con valor 0x80000000 y repetidamente hacer un shift a la derecha para verificar cada bit en $a0.
                </p>
            </div>
        </div>
        <footer class="w3-container w3-padding-32 w3-theme w3-center">
            <h2>CC3 - 2016</h2>
            <a class="w3-btn-floating w3-teal" href="https://slack.com/" title="SLACK"><i class="fa fa-slack"></i></a>
            <h4>Universidad Galileo</h4>
            <div style="position:relative;bottom:103px;z-index:1;" class="w3-tooltip w3-right">
                <a class="w3-btn w3-theme" href="#header"><span class="w3-xlarge">
                <i class="fa fa-chevron-circle-up"></i></span></a>
            </div>
        </footer>
    </body>
</html>
